% script to plot the garmin inreach points and terminus location for
% recovery

addpath C:/Users/kjwei/software/matlab/latlonutm/

% terminus file
term_file = 'S:\data\processed\Drone\LeconteTerminus\07152024\01\TermLatLon\LeconteTermVert07152024_1.csv';
term_file = 'G:Shared drives\Ice-ocean-interactions\fieldwork_docs_and_data\LeConte2406\data\processed\Drone\LeconteTerminus\07162024\02\TermLatLon\LeconteTermVert07162024_2.csv';
term_tab = readtable(term_file);

term_lat = term_tab.Y;
term_lon = term_tab.X;

% utm conversion
[term_x,term_y] = ll2utm(term_lat,term_lon);

% bottom left corner
x_min = min(term_x);
y_min = min(term_y);
term_x = term_x - x_min;
term_y = term_y - y_min;

% safe grid
dx = 2;
x_vec = -500:dx:(max(term_x));
y_vec = -500:dx:(max(term_y)+500);
nx = length(x_vec);
ny = length(y_vec);

danger_zone = zeros(nx,ny);
for i = 1:nx
    pt_x = x_vec(i);
    dxi2 = (term_x-pt_x).^2;
    for j = 1:ny
        pt_y = y_vec(j);
        dist = sqrt(dxi2 + (term_y-pt_y).^2);
        if any(dist<=300)
            danger_zone(i,j) = 1;
        elseif any(dist<=500)
            danger_zone(i,j) = 2;
        end
    end
end
%% update and run
% garmin

% MS02
ms_lon = [-132.360620,...
          -132.361736,...
          -132.362208,...
          -132.363925,...
          -132.364483,...
          -132.365341,...
          -132.364611,...
          -132.363131,...
          -132.363431,...
          -132.361908,...
          -132.361650,...
          -132.362810,...
          -132.363345,...
          -132.363110,...
          -132.361478,...
          -132.360491,...
          -132.360363,...
          -132.361843,...
          -132.363646,...
          -132.364075,...
          -132.364911,...
          -132.366950,...
          ];
ms_lat = [ 56.834291,...
           56.833498,...
           56.832983,...
           56.833766,...
           56.834291,...
           56.835130,...
           56.835280,...
           56.834540,...
           56.834518,...
           56.833970,...
           56.833166,...
           56.832468,...
           56.833208,...
           56.834443,...
           56.833873,...
           56.833776,...
           56.833391,...
           56.832308,...
           56.832361,...
           56.832565,...
           56.832780,...
           56.832318,...
           ];

% % MS01
% ms_lon = [-132.361671,...
%           -132.361671,...
%           -132.362273,...
%           -132.362273,...
%           -132.367958,...
%           -132.367958
%     ];
% ms_lat = [56.835676,...
%           56.834925,...
%           56.834078,...
%           56.833208,...
%           56.832940,...
%           56.833595,...
%     ];

% % MS01
% ms_lon = [-132.362186,...
%           -132.364418,...
%           -132.368645,...
%           -132.370298,...
%           -132.371135,...
%           -132.373173,...
%           -132.374160,...
%           -132.375276,...
%     ];
% ms_lat = [56.835998,...
%           56.835430,...
%           56.835140,...
%           56.835451,...
%           56.835686,...
%           56.834958,...
%           56.833338,...
%           56.831793,...
%     ];

% utm conversion
[ms_x,ms_y] = ll2utm(ms_lat,ms_lon);

% bottom left corner
ms_x = ms_x - x_min;
ms_y = ms_y - y_min;

% plot
lw = 1;

% lat lon
% figure(1); clf
% hold on
% box on
% plot(term_lon,term_lat,'k-','linewidth',lw);
% plot(ms_lon,ms_lat,'rx-','linewidth',lw);
% pbaspect([cosd(mean(term_lat)) 1 1]);
% xlabel('longitude')
% ylabel('latitude')

% utm
figure(2); clf
hold on
box on
pcolor(x_vec,y_vec,danger_zone')
plot(term_x,term_y,'k-','linewidth',lw);
plot(ms_x,ms_y,'rx-','linewidth',lw);
true_aspect
xlabel('easting (m)')
ylabel('northing (m)')
shading flat
